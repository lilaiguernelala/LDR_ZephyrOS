<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; Documentation LDR ZephyrOS </title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=d1a510d7"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/translations.js?v=bf059b8c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="prev" title="Welcome to LDR ZephyrOS’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            LDR ZephyrOS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="#embarque">Embarqué</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LDR ZephyrOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/my-first-post.md.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Lien vers cette rubrique"></a></h1>
<p>Dans le cadre des travaux de recherche menés au LDR sur les plateformes embarquées, les chercheurs souhaitent mettre en place des environnements de développements et de tests plus récents et robustes pour 2 applications en particulier, dans l’ordre d’importance :</p>
<ul class="simple">
<li><p>La programmation embarquée, en particulier avec OS Temps Réel.
Mettre en place un environnement de dev/tests avec sondes logicielles pour le temps réel. Pour réaliser des tests de systèmes contraints, possiblement utilisant des architectures matérielles diverses (ARM, RISC-V, etc.), les chercheurs ont besoin d’un environnement clair, générant des traces analysables (quantité de mémoire utilisée, temps passé sur le processeur et lors des accès aux périphériques, décisions d’ordonnancement, etc.).</p></li>
<li><p>Simulateur pour robotique/drone.
Mettre en place un environnement de dev/tests avec, par exemple CoppeliaSim et Python/ROS, génération de scénario et récupération des données de vol et de l’environnement simulé.<br />
Différents travaux sont réalisés depuis plusieurs années avec l’ONERA sur des simulations utilisant de drones. Ces travaux utilisent d’anciens simulateurs difficiles à maintenir aujourd’hui, ce qui rend complexe la reproduction de certains résultats. Plusieurs exemples existent pour des applications spécifiques, comme avec le robot Poppy et ROS.</p></li>
</ul>
<p>La documentation de la partie « Simulation » est disponible dans le dossier LDR_Simulation</p>
</section>
<section id="embarque">
<h1>Embarqué<a class="headerlink" href="#embarque" title="Lien vers cette rubrique"></a></h1>
<p>La première étape de cette partie consiste à mettre en place un code, à partir du code NoGUI vu en TP du module « Programmation temps réel » sur la carte ST STM32F429I Discovery avec ZephyrOS en se basant sur l’IDE PlatformIO qui :</p>
<ul class="simple">
<li><p>Récupère des traces simples de chaque thread.</p></li>
<li><p>Exporte les données et les affiches sur SEGGER SystemView.</p></li>
</ul>
<p><strong>Qu’est-ce que Zephyr OS ?</strong></p>
<p>Zephyr OS est un système d’exploitation temps réel open source. Il est reconnu pour sa légèreté, sa modularité et le fait qu’il supporte plusieurs plateformes, ce qui le rend adapté à une large gamme de microcontrôleurs. Avec une capacité à supporter plusieurs protocoles de communication.</p>
<p><strong>Qu’est-ce que PlatformIO ?</strong></p>
<p>PlatformIO est un IDE, son environnement de développement supporte le langage C/C++ pour les systèmes embarqués. Compatible avec plusieurs systèmes d’exploitation (Windows, Mac et Linux), il s’intègre également en tant qu’extension aux éditeurs de texte existants comme VSCode.</p>
<p><strong>Définition du Tracing</strong></p>
<p>L’utilisation du tracing dans un système d’exploitation temps réel comme <strong>ZephyrOS</strong> est bénéfique car il permet d’analyser le comportement du système en temps réel en enregistrant les évènements tel que les changements de threads. Cela aide à identifier les bugs ainsi que les problèmes de performances.
On peut également détecter les threads qui consomment trop de temps cela nous permet d’optimiser le système.</p>
<p>Il nous permet de comprendre le comportement de threads entre eux, à quelle fréquence les ressources système sont utilisées, cela nous permet d’avoir un aperçu sur le fonctionnement interne du système
Le tracing facilite l’analyse comparative et la reproductibilité des tests, on peut aussi vérifier si toutes les parties du code sont bien testées en conditions réelles</p>
<p><strong>Les étapes à suivre pour récupérer des traces d’un code</strong></p>
<p>Modifier le fichier .conf de notre projet NoGUI en ajoutant les lignes</p>
<p><strong>code</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_TRACING</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_SEGGER_SYSTEMVIEW</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_SEGGER_SYSTEMVIEW_BOOT_ENABLE</span><span class="o">=</span><span class="n">n</span>
<span class="n">CONFIG_SEGGER_SYSVIEW_POST_MORTEM_MODE</span><span class="o">=</span><span class="n">n</span>
<span class="n">CONFIG_SEGGER_RTT_BUFFER_SIZE_UP</span><span class="o">=</span><span class="mi">4096</span>
</pre></div>
</div>
<p>Zephyr utilise RTT (Real-Time Transfer) comme moyen de transport principal pour SystemView, dans ce cas l’exportation des traces nécessite toujours l’utilisation d’un appareil J-Link car ZephyrOS ne supporte pas actuellement l’exportation des traces via d’autres moyens comme l’UART ou le réseau, qui pourraient permettre une transmission directe sans hardware spécifique.</p>
<p>D’où l’intérêt d’utiliser un <strong>J-Link Segger EDU</strong> https://fr.farnell.com/segger/8-08-91-j-link-edu-mini/unit-d-education-cortex-m/dp/3106578?gross_price=true&amp;CMP=KNC-GFR-GEN-SHOPPING-Catch-All-GA4-Other-Channel-Audiences-Test-03-Nov-23&amp;mckv=_dc%7Cpcrid%7C%7Cplid%7C%7Ckword%7C%7Cmatch%7C%7Cslid%7C%7Cproduct%7C3106578%7Cpgrid%7C%7Cptaid%7C&amp;gad_source=1&amp;gclid=Cj0KCQjw3tCyBhDBARIsAEY0XNlGYtov5E70cmn43-1cGxXln7vgYtljY4FBiqdjiT4U-VoNwqK6bkgaAnjHEALw_wcB</p>
<p>pour pouvoir exporter les traces de chaque thread et les afficher sur SEGGER SystemView.</p>
<p>Ce qu’il faut installer pour la réalisation de cette partie :</p>
<ul class="simple">
<li><p>J-Link software https://www.segger.com/downloads/jlink/</p></li>
<li><p>SEGGER SystemView https://www.segger.com/downloads/systemview/</p></li>
</ul>
<blockquote>
<div><p>[!WARNING]
Sélectionnez le protocole SWD pendant la connexion du J-Link, tout en laissant le reste des paramètres par défaut (comme sur l’image en dessous)</p>
</div></blockquote>
<p><img alt="Terminal configuration" src="_images/Image2.jpg" /></p>
<p>Après avoir exécuter le code sur VSCode, et connecter le J-Link, les traces seront affichées en commençant l’enregistrement sur l’interface graphique de SEGGER SystemView.</p>
<p><img alt="SystemView traces" src="_images/Image1.png" /></p>
<p><strong>A quoi servent les traces ?</strong></p>
<p>Dans notre code on a trois threads (2 LEDs et un switch), le traçage permet de :</p>
<ul class="simple">
<li><p>Surveiller quand et combien de fois chaque thread est exécuté, c’est important pour analyser le comportement des threads.</p></li>
<li><p>Savoir par exemple la durée que prend chaque tâche pour exécuter une boucle, ou comment la pression du switch affecte le comportement des LEDs.</p></li>
<li><p>Si on voit que la LED 1 par exemple monopolise les ressources plus que prévu, on peut jouer sur le nombre d’itérations ou sur la priorité des threads.</p></li>
<li><p>Si un problème est détecté, on peut consulter les traces pour voir exactement ce qui se passait juste avant l’erreur</p></li>
</ul>
<p><strong>Les moyens de suivre des traces d’un code embarqué sans ZephyrOS</strong></p>
<ul class="simple">
<li><p>Freertos SystemView peut être utilisé pour enregistrer des applications qui utilisent FreeRTOS V8, V9, V10 ou V11. Jusqu’à la V10, la source FreeRTOS doit être légèrement modifiée pour afficher correctement l’exécution de l’ordonnanceur FreeRTOS. A partir de la V11, aucune modification du noyau n’est nécessaire.
RT-Thread Contraintes de TraceX</p></li>
<li><p>TraceX présente les contraintes suivantes :</p></li>
<li><p>TraceX ne peut pas mesurer avec précision les intervalles entre les événements supérieurs à la période de la minuterie.</p></li>
</ul>
<p><img alt="Traces sur TraceX" src="_images/Image3.png" /></p>
<p><strong>Tableau pour ajouter de nouvelles architectures au projet PlatformIO : autres cartes ST, RISC-V</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>RISC-V Boards</p></th>
<th class="head"><p>Zephyr version</p></th>
<th class="head"><p>Platformio</p></th>
<th class="head"><p>Zephyr + PlatformIO</p></th>
<th class="head"><p>Prix</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Seeed Studio XIAO ESP32C3</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌ https://docs.platformio.org/en/stable/boards/espressif32/seeed_xiao_esp32c3.html</p></td>
<td><p>5,96 €</p></td>
</tr>
<tr class="row-odd"><td><p>TTGO T-OI PLUS RISC-V ESP32-C3</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌ https://docs.platformio.org/en/stable/boards/espressif32/ttgo-t-oi-plus.html</p></td>
<td><p>$5.50</p></td>
</tr>
<tr class="row-even"><td><p>Espressif ESP32-C3-DevKitM-1</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌https://docs.platformio.org/en/stable/boards/espressif32/esp32-c3-devkitm-1.html</p></td>
<td><p>15,90 € TTC</p></td>
</tr>
<tr class="row-odd"><td><p>Espressif ESP32-C3-DevKitC-02</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌https://docs.platformio.org/en/stable/boards/espressif32/esp32-c3-devkitc-02.html</p></td>
<td><p>23,66 €</p></td>
</tr>
<tr class="row-even"><td><p>DFRobot Beetle ESP32-C3</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌https://docs.platformio.org/en/stable/boards/espressif32/dfrobot_beetle_esp32c3.html#dfrobot-beetle-esp32-c3</p></td>
<td><p>10,50 € TTC</p></td>
</tr>
<tr class="row-odd"><td><p>GAPuino GAP8</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>❌ Un kit orienté IA https://docs.platformio.org/en/stable/boards/riscv_gap/gapuino.html</p></td>
<td><p>230 €</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p><strong>Application réelle</strong></p>
<p>Créer un parking system, le vrai but derrière c’est de réussir à rajouter le plus de composants possibles (capteurs, actionneurs…) sur le projet ZephyrOS déjà existant.</p>
<p><em><strong>Explication sur le parking system</strong></em>
À l’entrée du système de stationnement, un scanner permet de détecter l’arrivée d’un véhicule. Une fois que l’ISR est déclenché, un mot de passe est envoyé au système et s’il correspond au mot de passe correct, le portail s’ouvre pour permettre au véhicule d’entrer. Dans le cas contraire, le portail reste verrouillé. Si le véhicule entre dans le parking, le nombre de places de parking est mis à jour. S’il n’y a pas de place de parking disponible, le système enverra le message « Parking non disponible » afin que les gens gagnent du temps.
Capteur ultrason n’utilise pas d’interface de communication (I2C ou UART), ils utilisent généralement que des broches GPIO pour se connecter.
Pour pouvoir rajouter le capteur de distance à notre projet zephyr, il faut créer un driver puisqu’il n’existe pas encore</p>
<p>à rajouter dans le .overlay du projet</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="nx">hcsr04</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;elecfreaks,hc-sr04&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HCSR04&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">trig</span><span class="o">-</span><span class="nx">gpios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="nx">gpio0</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="nx">GPIO_ACTIVE_HIGH</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">echo</span><span class="o">-</span><span class="nx">gpios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="nx">gpio0</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="nx">GPIO_ACTIVE_HIGH</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;okay&quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to LDR ZephyrOS’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, IGUERNELALA Lila.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>